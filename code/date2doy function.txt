date2doy <- function(x) {
  # Ensure the input is a POSIX date-time object
  stopifnot(any(grepl("^POSIX", class(x[1]))))
  
  # Extract the day of the year as a numeric value
  day <- as.numeric(format(x, "%j"))
  
  # Pattern to match the time part of the date-time string
  pat <- quote("([0-9]{2}:){2}[0-9]{2}")
  
  # Convert the time part to midnight (00:00:00) in GMT timezone
  midnight <- as.POSIXct(gsub(pat, "00:00:00", x), tz = "GMT")
  
  # Calculate the fractional day difference from midnight
  frac <- as.numeric(difftime(x, midnight, units = "days"))
  
  # Return the day of the year with the fractional part
  day + frac
}
